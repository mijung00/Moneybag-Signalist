commands:
  01_install_chromium_dynamically:
    # 서버 아키텍처(x86_64 vs aarch64)를 감지하여 동적으로 크로미움을 설치합니다.
    command: |
      ARCH=$(uname -m)
      LOG_FILE="/var/log/chromium_install.log"
      echo "Starting Chromium installation for $ARCH architecture." > $LOG_FILE

      # 공통 필수 라이브러리 설치
      sudo yum install -y alsa-lib atk at-spi2-atk cups-libs gtk3 ipa-gothic-fonts libXcomposite libXcursor libXdamage libXext libXi libXrandr libXScrnSaver libXtst pango xorg-x11-fonts-Type1 xorg-x11-font-utils libgbm -y >> $LOG_FILE 2>&1

      if [ "$ARCH" = "aarch64" ]; then
        echo "ARM architecture (aarch64) detected. Downloading pre-built Chromium." >> $LOG_FILE
        cd /tmp
        curl -Lo chromium.zip https://github.com/Sparticuz/chromium/releases/download/v123.0.1/chromium-v123.0.1-pack.zip >> $LOG_FILE 2>&1
        unzip chromium.zip >> $LOG_FILE 2>&1
        sudo mv pack /opt/chromium
        sudo ln -sf /opt/chromium/chrome /usr/bin/chromium
        sudo ln -sf /opt/chromium/chrome /usr/bin/chromium-browser
      else
        echo "x86_64 architecture detected. Installing Chromium from EPEL." >> $LOG_FILE
        sudo amazon-linux-extras install epel -y >> $LOG_FILE 2>&1
        sudo yum install -y chromium >> $LOG_FILE 2>&1
        sudo ln -sf /usr/bin/chromium-browser /usr/bin/chromium
      fi
      echo "Chromium installation finished." >> $LOG_FILE
    # 에러가 발생해도 배포가 중단되지 않도록 || true 추가
    test: "exit 0"