files:
  "/etc/cron.d/my_cron_job":
    mode: "000644"
    owner: root
    group: root
    content: |
      SHELL=/bin/bash
      PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

      # ---------------------------------------------------------
      # [Iceage] 주식 정보 & 시그널리스트
      # ---------------------------------------------------------
      # 1. 시그널리스트 모닝 브리핑 (매일 아침 07:00 KST) -> [테스트용 임시 수정: 08:27 KST]
      # KST 07:00 = UTC 22:00 (전날)
      35 23 * * * root bash -lc 'echo "[START newsletter] $(date -Is)"; set -a; . /opt/elasticbeanstalk/deployment/env; set +a; bash /var/app/current/run_iceage.sh newsletter; rc=$?; echo "[END newsletter] $(date -Is) rc=$rc"; exit $rc' >> /var/log/newsletter_cron.log 2>&1

      # 1-2. 시그널리스트 주간 리포트 (매주 토요일 아침 08:00 KST)
      # KST 08:00 (토) = UTC 23:00 (금)
      # 참고: 위와 같이 서버 시간(UTC) 기준 '금요일'로 설정해야 한국 시간 '토요일' 아침에 실행됩니다. (현재 설정 정상)
      00 23 * * 5 root bash -lc 'echo "[START weekly_report] $(date -Is)"; set -a; . /opt/elasticbeanstalk/deployment/env; set +a; bash /var/app/current/run_iceage_weekly.sh; rc=$?; echo "[END weekly_report] $(date -Is) rc=$rc"; exit $rc' >> /var/log/iceage_weekly.log 2>&1

      # 1-3. 시그널리스트 월간 리포트 (매월 1일 아침 09:00 KST)
      # KST 09:00 (1일) = UTC 00:00 (1일)
      # [수정] 'L'(월말) 옵션은 표준 cron에서 지원하지 않아 불안정하므로, 가장 안정적인 '매월 1일 09:00 KST'로 변경합니다.
      00 00 1 * * root bash -lc 'echo "[START monthly_report] $(date -Is)"; set -a; . /opt/elasticbeanstalk/deployment/env; set +a; bash /var/app/current/run_iceage_monthly.sh; rc=$?; echo "[END monthly_report] $(date -Is) rc=$rc"; exit $rc' >> /var/log/iceage_monthly.log 2>&1

      # 2. KRX 데이터 3종 3일치 수집 (매일 저녁 20:00 KST)
      # KST 20:00 = UTC 11:00 (당일)
      00 11 * * * root bash -lc 'echo "[START krx] $(date -Is)"; set -a; . /opt/elasticbeanstalk/deployment/env; set +a; bash /var/app/current/run_krx_batch.sh; rc=$?; echo "[END krx] $(date -Is) rc=$rc"; exit $rc' >> /var/log/krx_batch.log 2>&1

      # ---------------------------------------------------------
      # [Moneybag] 코인 리포트
      # ---------------------------------------------------------
      # 3. 머니백 모닝 리포트 (매일 아침 07:30 KST) -> [테스트용 임시 수정: 08:34 KST]
      # KST 07:30 = UTC 22:30 (전날)
      42 23 * * * root bash -lc 'echo "[START moneybag_morning] $(date -Is)"; set -a; . /opt/elasticbeanstalk/deployment/env; set +a; bash /var/app/current/run_moneybag.sh morning; rc=$?; echo "[END moneybag_morning] $(date -Is) rc=$rc"; exit $rc' >> /var/log/moneybag_morning.log 2>&1

      # 4. 머니백 나이트 리포트 (매일 저녁 21:00 KST)
      # KST 21:00 = UTC 12:00 (당일)
      00 12 * * * root bash -lc 'echo "[START moneybag_night] $(date -Is)"; set -a; . /opt/elasticbeanstalk/deployment/env; set +a; bash /var/app/current/run_moneybag.sh night; rc=$?; echo "[END moneybag_night] $(date -Is) rc=$rc"; exit $rc' >> /var/log/moneybag_night.log 2>&1

      # (마지막 빈 줄 필수 - 지우지 마세요)

commands:
  remove_old_cron:
    command: "rm -f /etc/cron.d/my_cron_job.bak"
