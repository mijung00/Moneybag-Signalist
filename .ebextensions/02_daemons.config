files:
  "/etc/systemd/system/moralis-listener.service":
    mode: "000644"
    owner: root
    group: root
    content: |
      [Unit]
      Description=Moralis Webhook Listener Service
      After=network.target

      [Service]
      Type=simple
      User=webapp
      Group=webapp
      WorkingDirectory=/var/app/current
      ExecStart=/bin/bash /var/app/current/run_moralis_listener.sh
      Restart=always
      RestartSec=10
      KillSignal=SIGINT
      StandardOutput=syslog
      StandardError=syslog
      SyslogIdentifier=moralis-listener

      [Install]
      WantedBy=multi-user.target

  "/etc/systemd/system/watchdog.service":
    mode: "000644"
    owner: root
    group: root
    content: |
      [Unit]
      Description=Fincore Watchdog Service
      After=network.target

      [Service]
      Type=simple
      User=root
      WorkingDirectory=/var/app/current
      ExecStart=/bin/bash /var/app/current/run_watchdogs.sh
      Restart=always
      RestartSec=30
      KillSignal=SIGINT
      StandardOutput=syslog
      StandardError=syslog
      SyslogIdentifier=watchdog

      [Install]
      WantedBy=multi-user.target

container_commands:
  01_make_executable:
    command: "chmod +x /var/app/staging/run_moralis_listener.sh /var/app/staging/run_watchdogs.sh"
  02_enable_and_start_services:
    command: "systemctl enable moralis-listener.service watchdog.service && systemctl restart moralis-listener.service watchdog.service"