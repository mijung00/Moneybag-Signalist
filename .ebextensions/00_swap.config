# .ebextensions/00_swap.config
# 이 파일은 Elastic Beanstalk 환경의 모든 EC2 인스턴스에서 스왑 파일 설정을 관리합니다.
# 기본적으로 생성되는 2GB 스왑 파일 대신 512MB의 작은 스왑 파일을 생성합니다.

commands:
  01_remove_existing_swap:
    # 기존에 /swapfile이 존재하면 비활성화하고 삭제합니다.
    command: |
      if [ -f /swapfile ]; then
        swapoff /swapfile
        rm -f /swapfile
      fi
    # 파일이 없어서 실패하더라도 무시하고 계속 진행합니다.
    ignoreErrors: true

  02_create_512mb_swap:
    # 512MB 크기의 새 스wap 파일을 생성하고 활성화합니다.
    command: |
      dd if=/dev/zero of=/swapfile bs=1M count=512
      chmod 600 /swapfile
      mkswap /swapfile
      swapon /swapfile
    # 이 명령은 /swapfile이 없을 때만 실행됩니다.
    test: "[ ! -f /swapfile ]"