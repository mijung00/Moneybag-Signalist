files:
  "/etc/systemd/system/moralis_listener.service":
    mode: "000644"
    owner: root
    group: root
    content: |
      [Unit]
      Description=Fincore Moralis Listener Service
      After=network.target

      [Service]
      Type=simple
      User=webapp
      Group=webapp
      WorkingDirectory=/var/app/current
      # [추가] 스크립트 실행 권한을 보장합니다.
      ExecStartPre=/bin/bash -c "chmod +x /var/app/current/run_moralis_listener.sh"
      ExecStart=/var/app/current/run_moralis_listener.sh
      Restart=always
      RestartSec=10
      # [추가] Beanstalk 환경 변수를 서비스에 주입합니다.
      EnvironmentFile=/opt/elasticbeanstalk/deployment/env

      [Install]
      WantedBy=multi-user.target

container_commands:
  21_reload_systemd_for_listener:
    command: "systemctl daemon-reload"
  22_enable_moralis_listener:
    command: "systemctl enable moralis_listener.service"
  23_restart_moralis_listener:
    command: "systemctl restart moralis_listener.service"