files:
  "/etc/systemd/system/watchdog.service":
    mode: "000644"
    owner: root
    group: root
    content: |
      [Unit]
      Description=Fincore Watchdog Service (Patched)
      After=network.target

      [Service]
      Type=simple
      User=webapp
      Group=webapp
      WorkingDirectory=/var/app/current
      ExecStartPre=/bin/bash -c "chmod +x /var/app/current/run_watchdogs.sh"
      ExecStart=/var/app/current/run_watchdogs.sh
      Restart=always
      RestartSec=10
      EnvironmentFile=/opt/elasticbeanstalk/deployment/env

      [Install]
      WantedBy=multi-user.target

container_commands:
  11_reload_systemd_for_watchdog:
    command: "systemctl daemon-reload"
  13_restart_watchdog:
    command: "systemctl restart watchdog.service"