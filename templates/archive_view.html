{% extends "base.html" %}

{% block content %}

<div class="relative w-full bg-white rounded-t-2xl border border-gray-200 shadow-sm mb-0 z-10 h-32 flex flex-col justify-center">
    
    <div class="flex items-center justify-between px-6">
        
        <a href="{{ url_for('archive_view', service_name=service_name, date_str=prev_date) }}" 
           class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100 text-gray-400 hover:text-black transition">
            <i class="fa-solid fa-chevron-left"></i>
        </a>

        <div class="relative flex flex-col items-center justify-center text-center cursor-pointer group">
             <input type="date" 
                    value="{{ date_str }}" 
                    max="{{ today_str }}"
                    onchange="window.location.href='/archive/{{ service_name }}/' + this.value"
                    class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20">

             <p class="text-[11px] font-bold text-gray-400 tracking-[0.2em] uppercase mb-1">ISSUE DATE</p>
             
             <div class="flex items-center justify-center space-x-2">
                 <h2 class="text-3xl font-black text-gray-900 tabular-nums tracking-tight" style="font-family: 'Pretendard', sans-serif;">
                     {{ date_str }}
                 </h2>
                 <i class="fa-regular fa-calendar text-gray-300 group-hover:text-blue-600 transition-colors text-lg"></i>
             </div>
        </div>

        {% if date_str >= today_str %}
            <div class="flex items-center justify-center w-10 h-10 rounded-full text-gray-200 cursor-not-allowed">
                <i class="fa-solid fa-chevron-right"></i>
            </div>
        {% else %}
            <a href="{{ url_for('archive_view', service_name=service_name, date_str=next_date) }}" 
               class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100 text-gray-400 hover:text-black transition">
                <i class="fa-solid fa-chevron-right"></i>
            </a>
        {% endif %}
    </div>

    <div class="absolute bottom-0 left-0 w-full h-[1px] bg-gray-100"></div>
</div>


<div class="w-full bg-white rounded-b-2xl border-x border-b border-gray-200 shadow-sm overflow-hidden relative min-h-[600px]">
    
    <div class="p-8 md:p-12">
        <style>
            .report-reset {
                background-color: transparent !important;
                font-family: 'Pretendard', sans-serif !important;
                color: #333 !important;
                line-height: 1.8 !important;
                font-size: 16px !important;
                width: 100% !important;
                overflow-x: auto; /* [수정] 모바일에서 표가 잘릴 때 스크롤 가능하게 */
            }
            .report-reset * {
                background-color: transparent !important; /* 배경 투명화 */
                box-sizing: border-box !important;
                max-width: 100% !important;
            }
            /* [추가] 테이블 가독성 개선 */
            .report-reset table {
                width: 100% !important;
                min-width: 600px; /* 모바일에서 최소 너비 확보 */
                border-collapse: collapse !important;
                margin: 25px 0 !important;
            }
            .report-reset th, .report-reset td {
                border: 1px solid #e5e7eb !important;
                padding: 12px 15px !important;
                text-align: center !important;
                vertical-align: middle !important;
            }
            /* 제목 */
            .report-reset h1, .report-reset h2 {
                color: #111 !important;
                font-weight: 800 !important;
                margin-top: 40px !important;
                margin-bottom: 20px !important;
                line-height: 1.3 !important;
            }
            .report-reset h1 { font-size: 26px !important; }
            .report-reset h2 { font-size: 22px !important; }
            
            /* 이미지 */
            .report-reset img {
                display: block !important;
                margin: 30px auto !important;
                height: auto !important;
                border-radius: 8px !important;
                border: 1px solid #f3f4f6 !important;
            }
        </style>

        <div class="report-reset {% if is_locked %}blur-md select-none opacity-20{% endif %}">
            {{ content_html | safe }}
        </div>
    </div>

    {% if is_locked or content_html is none %}
    <!-- [수정] 잠금 화면 UI 변경: 상단에 고정 -->
    <div class="absolute top-0 left-0 w-full flex items-start justify-center z-10 p-4 pt-16">
        <div class="bg-white/90 backdrop-blur-md p-8 rounded-2xl shadow-2xl border border-gray-200 text-center max-w-md w-full">
            
            {% if content_html is none %}
                <div class="w-14 h-14 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400">
                    <i class="fa-regular fa-folder-open text-2xl"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-900 mb-2">리포트가 없습니다</h3>
                <p class="text-sm text-gray-500 mb-6">해당 날짜의 기록이 없습니다.</p>
                <a href="{{ url_for('archive_latest', service_name=service_name) }}" class="text-sm font-bold underline">최신 리포트로 가기</a>
            {% else %}
                <div class="w-14 h-14 bg-black rounded-full flex items-center justify-center mx-auto mb-4 text-white">
                    <i class="fa-solid fa-lock text-xl"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-900 mb-2">최신 리포트 즉시 받아보기</h3>
                <p class="text-sm text-gray-500 mb-6">아래 이메일을 입력하시면, 지금 보고 계신 리포트 전문을 바로 보내드립니다.</p>
                
                <!-- [추가] 이메일 발송 폼 -->
                <form action="{{ url_for('index') }}" method="POST" class="space-y-4">
                    <input type="hidden" name="action" value="unlock">
                    <input type="hidden" name="service_name" value="{{ service_name }}">
                    <input type="hidden" name="date_str" value="{{ date_str }}">
                    <div class="space-y-3">
                        <input type="email" name="email" required placeholder="이메일 주소 (필수)"
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white focus:ring-2 focus:ring-black focus:border-transparent outline-none transition-all text-center">
                        <input type="text" name="name" placeholder="닉네임 (선택)"
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white focus:ring-2 focus:ring-black focus:border-transparent outline-none transition-all text-center">
                    </div>
                    <button type="submit" 
                            class="block w-full py-3 bg-black text-white font-bold rounded-xl hover:bg-gray-800 transition shadow-md text-sm">
                        <i class="fa-solid fa-envelope mr-2"></i> 리포트 받기
                    </button>
                </form>
            {% endif %}
        </div>
    </div>
    {% endif %}

</div>

{% endblock %}